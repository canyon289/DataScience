---
title: "Assignment 2"
author: "Ravin"
date: "Friday, September 05, 2014"
output: html_document
---

This analysis used storm data available onlien and condensed it to provide concise recommendations as to where to allocate resources. Summary analysis were performed to determine the most deadly and costly weather events across the United States. It was found that tornadoes by far were the deadliest weather event

```{r setup, include=FALSE}
knitr::opts_chunk$set(cache=TRUE)
```

Downloading file for analysis
```{r DownloadFiles, eval = FALSE}
download.file(url = "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2FStormData.csv.bz2", destfile = "storm.bz2")
```

Load file into storm dataframe
```{r LoadData, echo=FALSE, eval = FALSE}
storm = read.csv(bzfile("storm.bz2"))
```

Define damage function which estimates cost mulipliers for damage cost
```{r DamageFunction}
fdamage = function(x){
  #Set Multipliers
  factorlevel = c("","-","?","+","0","1","2","3","4","5","6","7","8","B","h","H","K","m","M")
  
  #Some of the factor levels were not known and were assumed to be zero
  factormultiplier = c(0,0,0,0,0,1,2,3,4,5,6,7,10^9,100,100,1000,1000,10^6,10^6)
  
  names(factormultiplier) = factorlevel
  return(factormultiplier[[x]])
}
```

Add damage column to table
```{r CostofDamage}

damage <- (storm[["CROPDMG"]]*sapply(storm[["CROPDMGEXP"]],fdamage) 
          +storm[["PROPDMG"]]*sapply(storm[["PROPDMGEXP"]],fdamage))

storm = cbind(storm,damage)
rm(damage)
```

Data by event type and fatality
```{r FatalitiesSummary}
library(plyr)
ef = ddply(storm, .(EVTYPE), summarise, fatalities = sum(FATALITIES), injuries = sum(INJURIES), affected = (sum(FATALITIES)+sum(INJURIES)), damage = sum(damage))

ef = ef[order(ef$affected, decreasing = TRUE),]
```


```{r Diasters}
library(reshape2)
library(ggplot2)
dfm = melt(data = ef[1:10,], measure.vars = c("fatalities","injuries","affected"))

ggplot(dfm, aes(reorder(EVTYPE,-value), value, fill = variable)) + geom_bar(position = "dodge", stat = "identity") + scale_x_discrete(labels = abbreviate)
```


```{r Costs}
ef = ef[order(ef$damage, decreasing = TRUE),]
ggplot(ef[1:10,], aes(x = reorder(EVTYPE,-damage),damage))+ geom_bar(position = "dodge", stat = "identity") + scale_x_discrete(labels = abbreviate)
```



#Appendix
```{r LoadData, eval = FALSE}
```

